<!DOCTYPE html>
<html lang ="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout=”http://www.ultraq.net.nz/thymeleaf/layout”
      xmlns:sec="http://www/thymeleaf.org"
      layout:decorate="~{layout}"
>
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .container {
            max-width: 2000px; /* Увеличьте это значение для увеличения ширины строки */
        }
        h3 {
            color: #b6b6b6;
            font-family: 'Arial', serif;
            font-size: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .btn {
            display: inline-block;
            font-weight: 400;
            color: #ffffff; /* Изменено на белый для лучшего контраста */
            text-align: center;
            vertical-align: middle;
            cursor: pointer;
            background-color: #021d44; /* Изменено на томатный цвет для яркости */
            border: 1px solid transparent;
            padding: .375rem .75rem;
            font-size: 1rem;
            line-height: 1.5;
            border-radius: .25rem;
            transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;
            margin-top: 20px;
        }

        .btn:hover {
            color: #ffffff;
            background-color: #5d5d5d;
            border-color: #bbb4b4;
        }


    </style>

</head>
<body  data-page-no="${news.pageNo}" data-page-size="${news.pageSize}" data-category="${category}" data-language="${language}" data-query="${query}">
<section layout:fragment="body" class="py-5">
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-4">
                <form id="newsForm" action="/news/find" method="get">
                    <h3>Categories</h3>
                    <select name="category" id="category" class="list-group" style="width:400px;height: 40px">
                        <option value="">No Specify</option>
                        <option value="top">Top</option>
                        <option value="sports">Sport</option>
                        <option value="environment">Environment</option>
                        <option value="crime">Crime</option>
                        <option value="health">Health</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="politics">Politics</option>
                        <option value="science">Science</option>
                        <option value="business">Business</option>
                        <option value="tourism">Tourism</option>
                        <option value="world">World</option>
                        <option value="other">Other</option>
                    </select>

                    <br/>
                    <h3>Language</h3>
                    <select name="language" id="language" style="width:400px; height: 40px">
                        <option value="">No Specify</option>
                        <option value="arabic">Arabic</option>
                        <option value="chinese">Chinese</option>
                        <option value="dutch">Dutch</option>
                        <option value="english">English</option>
                        <option value="finnish">Finnish</option>
                        <option value="french">French</option>
                        <option value="german">German</option>
                        <option value="greek">Greek</option>
                        <option value="hebrew">Hebrew</option>
                        <option value="hindi">Hindi</option>
                        <option value="hungarian">Hungarian</option>
                        <option value="icelandic">Icelandic</option>
                        <option value="indonesian">Indonesian</option>
                        <option value="italian">Italian</option>
                        <option value="japanese">Japanese</option>
                        <option value="korean">Korean</option>
                        <option value="latvian">Latvian</option>
                        <option value="lithuanian">Lithuanian</option>
                        <option value="malay">Malay</option>
                        <option value="norwegian">Norwegian</option>
                        <option value="persian">Persian</option>
                        <option value="polish">Polish</option>
                        <option value="portuguese">Portuguese</option>
                        <option value="romanian">Romanian</option>
                        <option value="russian">Russian</option>
                        <option value="serbian">Serbian</option>
                        <option value="slovak">Slovak</option>
                        <option value="slovenian">Slovenian</option>
                        <option value="spanish">Spanish</option>
                        <option value="swedish">Swedish</option>
                        <option value="thai">Thai</option>
                        <option value="turkish">Turkish</option>
                        <option value="ukrainian">Ukrainian</option>
                        <option value="vietnamese">Vietnamese</option>
                    </select>


                    <br/>
                    <input type="submit" value="Search" class="btn">
                </form>

            </div>

            <div class="col-md-8">
                <div>
                    <form th:action ="@{/news/search}" class="form-inline my-2 my-lg-0 mb-3">
                        <input id="query" name="query" class ="form-control mr-sm-2 mb-5" type="search" placeholder="Search news" aria-label="Search">
                    </form>
                </div>
                <div th:if="${news != null}">
                <div class="row" >
                <!-- Thymeleaf for each loop to iterate over news_list -->

                    <div th:each="news : ${news.data}" class="col-lg-3"> <!-- Change this to col-md-3 for 4 cards in a row -->
                    <div class="card mb-4" style="overflow: auto">
                        <div class="card-body" style="height: 400px;width: 300px;">
                            <h5 class="card-title" th:text="${news.title}"></h5>
                            <p class="card-text">
                                <strong>Published Date:</strong> <span th:text="${news.pubdate}"></span><br/>
                                <strong>Categories:</strong>
                                <span th:each="category : ${news.category}" th:text="${category}+' '"></span>
                                <span th:if="${#lists.isEmpty(news.category)}">no specified</span>
                                <br/><strong>Language :</strong> <span th:text="${news.language}"></span><br/>
                            </p>
                        </div>
                        <a class="btn btn-primary" th:href="@{/news/{newsId}(newsId = ${news.id})}">Detail</a>
                    </div>
                </div>
                    <div th:if="${news == null}">
                        <h2>Нет новостей</h2>
                    </div>
                </div>


            <!--Pagination-->
            <nav aria-label="Pagination">
                <ul class="pagination justify-content-center my-4">
                    <li class="page-item" th:class="${news.pageNo == 0} ? 'disabled' : ''">
                        <a class="page-link" id="newerLink" tabindex="-1" aria-disabled="true">Newer</a>
                    </li>
                    <li th:each="pageNumber : ${#numbers.sequence(0, news.totalPages - 1)}" class="page-item" th:class="${pageNumber == news.pageNo} ? 'active' : ''">
                        <a class="page-link page-number-link" th:text="${pageNumber + 1}"></a>
                    </li>
                    <li class="page-item" th:class="${news.pageNo == news.totalPages - 1} ? 'disabled' : ''">
                        <a class="page-link" id="olderLink">Older</a>
                    </li>
                </ul>
            </nav>

                    <script>
                        window.addEventListener('load', function() {
                            var path = window.location.pathname; var body = document.querySelector('body');
                            var pageNo = body.getAttribute('data-page-no') || 0;
                            var pageSize = body.getAttribute('data-page-size') || 10;
                            var category = '';var language = ''; var query = body.getAttribute('data-query') || '';
                            // Если мы находимся на странице /news/find или /news/search, получаем выбранную категорию, язык и поисковый запрос из localStorage
                            if (path === '/news/find' || path === '/news/search') {
                                category = localStorage.getItem('selectedCategory') || '';
                                language = localStorage.getItem('selectedLanguage') || '';
                                query = localStorage.getItem('selectedQuery') || ''; // Добавлено
                                }
                            if (category) {
                                category = "&category=" + category;
                            }
                            if (language) {
                                language = "&language=" + language;
                            }
                            if (query) {
                                query = "&query=" + query; // Добавлено
                            }
                            document.getElementById('newerLink').href = path + "?pageNo=" + (pageNo - 1) + "&pageSize=" + pageSize + category + language + query;
                            document.getElementById('olderLink').href = path + "?pageNo=" + (pageNo + 1) + "&pageSize=" + pageSize + category + language + query;
                            var pageNumberLinks = document.getElementsByClassName('page-number-link');
                            for (var i = 0; i < pageNumberLinks.length; i++) {
                                pageNumberLinks[i].href = path + "?pageNo=" + i + "&pageSize=" + pageSize + category + language + query;
                            }

                            document.getElementById('newsForm').addEventListener('submit', function(e) {
                                e.preventDefault();

                                var category = document.getElementById('category').value; var language = document.getElementById('language').value;
                                var query = document.getElementById('query').value; // Предполагается, что у вас есть поле ввода с id='query'

                                var url = '/news/find';
                                var params = [];

                                // Сохраняем выбранную категорию, язык и поисковый запрос в localStorage
                                localStorage.setItem('selectedCategory', category);
                                localStorage.setItem('selectedLanguage', language);
                                localStorage.setItem('selectedQuery', query);

                                if (category === '' && language === '' && query === '') {
                                    window.location.href = '/news';
                                    return;
                                }

                                if (category !== '') {
                                    params.push('category=' + encodeURIComponent(category));
                                }
                                if (language !== '') {
                                    params.push('language=' + encodeURIComponent(language));
                                }
                                if (query !== '') {
                                    params.push('query=' + encodeURIComponent(query)); // Добавлено
                                }

                                if (params.length > 0) {
                                    url += '?' + params.join('&');
                                }
                                var pageNumberLinks = document.getElementsByClassName('page-number-link');
                                for (var i = 0; i < pageNumberLinks.length; i++) {
                                    pageNumberLinks[i].href = path + "?pageNo=" + i + "&pageSize=" + pageSize + category + language + query;
                                }

                                window.location.href = url;

                            });


                            // Получаем выбранные категорию, язык и поисковый запрос из localStorage
                            var selectedCategory = localStorage.getItem('selectedCategory');
                            var selectedLanguage = localStorage.getItem('selectedLanguage');
                            var selectedQuery = localStorage.getItem('selectedQuery'); // Добавлено

                            // Находим элементы select и input на странице
                            var categorySelect = document.getElementById('category');
                            var languageSelect = document.getElementById('language');
                            var queryInput = document.getElementById('query'); // Предполагается, что у вас есть поле ввода с id='query'

                            // Устанавливаем выбранные значения для каждого select и input
                            if (selectedCategory) {
                                categorySelect.value = selectedCategory;
                            }
                            if (selectedLanguage) {
                                languageSelect.value = selectedLanguage;
                            }
                            if (selectedQuery) {
                                queryInput.value = selectedQuery; // Добавлено
                            }
                        });
                    </script>
                </div>
            </div>
        </div>
    </div>
</section>
</body>
</html>
